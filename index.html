<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>俄罗斯定价器</title>
    <!-- 引入 React 核心库 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 引入 Babel 用于解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入 Tailwind CSS 样式 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide 图标库 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 图标组件适配器
        const Icon = ({ name, className }) => {
            const [iconSvg, setIconSvg] = useState('');
            useEffect(() => {
                if (window.lucide) {
                    const svg = window.lucide.createIcons();
                }
            }, []);
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            // --- 状态管理 (完全保留你的原始状态) ---
            const [exchangeRate, setExchangeRate] = useState(11.36); 
            const [platform, setPlatform] = useState('wildberries');
            const [sourcingCostCNY, setSourcingCostCNY] = useState(50); 
            const [domesticShippingCNY, setDomesticShippingCNY] = useState(6);
            const [weight, setWeight] = useState(1); 
            const [shippingRate, setShippingRate] = useState(55); 
            const [extraLogisticsCostCNY, setExtraLogisticsCostCNY] = useState(0); 
            const [platformFeePercent, setPlatformFeePercent] = useState(12); 
            const [paymentFeePercent, setPaymentFeePercent] = useState(2); 
            const [exchangeLossPercent, setExchangeLossPercent] = useState(2); 
            const [returnRatePercent, setReturnRatePercent] = useState(10); 
            const [adCosPercent, setAdCosPercent] = useState(0); 
            const [fixedFeeRUB, setFixedFeeRUB] = useState(0); 
            const [targetMarginPercent, setTargetMarginPercent] = useState(30); 
            const [sellingPriceRUB, setSellingPriceRUB] = useState(2866); 
            const [mode, setMode] = useState('byPrice'); 

            const [results, setResults] = useState({
                totalProductCostCNY: 0, logisticsCNY: 0, returnLossCNY: 0,
                platformFeeCNY: 0, paymentFeeCNY: 0, exchangeLossCNY: 0,
                marketingCNY: 0, fixedFeeCNY: 0, totalCostCNY: 0,
                netProfitCNY: 0, margin: 0, roi: 0,
                breakEvenPriceRUB: 0, suggestedPriceRUB: 0
            });

            const presets = {
                wildberries: { name: 'Wildberries (WB)', platformFee: 15, paymentFee: 1.0, exchangeLoss: 3.0, returnRate: 20, adCos: 10 },
                ozon: { name: 'Ozon', platformFee: 10, paymentFee: 1.0, exchangeLoss: 2.0, returnRate: 5, adCos: 10 }
            };

            const applyPreset = (key) => {
                setPlatform(key);
                const p = presets[key];
                setPlatformFeePercent(p.platformFee);
                setPaymentFeePercent(p.paymentFee);
                setExchangeLossPercent(p.exchangeLoss);
                setReturnRatePercent(p.returnRate);
                setAdCosPercent(p.adCos);
            };

            const calculate = () => {
                const productCost = parseFloat(sourcingCostCNY) + parseFloat(domesticShippingCNY);
                const logisticsCost = (parseFloat(weight) * parseFloat(shippingRate)) + parseFloat(extraLogisticsCostCNY);
                const totalVariableRate = (
                    parseFloat(platformFeePercent) + parseFloat(paymentFeePercent) + 
                    parseFloat(exchangeLossPercent) + parseFloat(adCosPercent) + parseFloat(returnRatePercent) 
                ) / 100;

                let activePriceRUB = parseFloat(sellingPriceRUB);
                if (mode === 'byMargin') {
                    const fixedCostsRUB = (productCost + logisticsCost) * exchangeRate + parseFloat(fixedFeeRUB);
                    const denominator = 1 - totalVariableRate - (parseFloat(targetMarginPercent) / 100);
                    activePriceRUB = denominator > 0 ? fixedCostsRUB / denominator : 0;
                }

                const revenueCNY = activePriceRUB / exchangeRate;
                const pFeeCNY = (activePriceRUB * (platformFeePercent / 100)) / exchangeRate;
                const payFeeCNY = (activePriceRUB * (paymentFeePercent / 100)) / exchangeRate;
                const exLossCNY = (activePriceRUB * (exchangeLossPercent / 100)) / exchangeRate;
                const adFeeCNY = (activePriceRUB * (adCosPercent / 100)) / exchangeRate;
                const returnLossCNY = (activePriceRUB * (returnRatePercent / 100)) / exchangeRate; 
                const fFeeCNY = parseFloat(fixedFeeRUB) / exchangeRate;

                const totalDeductionsCNY = productCost + logisticsCost + pFeeCNY + payFeeCNY + exLossCNY + adFeeCNY + returnLossCNY + fFeeCNY;
                const netProfit = revenueCNY - totalDeductionsCNY;
                const margin = activePriceRUB > 0 ? (netProfit / revenueCNY) * 100 : 0;
                const totalInvested = productCost + logisticsCost + adFeeCNY; 
                const roi = totalInvested > 0 ? (netProfit / totalInvested) * 100 : 0;

                let breakEvenRUB = 0;
                if (totalVariableRate < 1) {
                    breakEvenRUB = ((productCost + logisticsCost) * exchangeRate + parseFloat(fixedFeeRUB)) / (1 - totalVariableRate);
                }

                setResults({
                    totalProductCostCNY: productCost, logisticsCNY: logisticsCost, returnLossCNY,
                    platformFeeCNY: pFeeCNY, paymentFeeCNY: payFeeCNY, exchangeLossCNY: exLossCNY,
                    marketingCNY: adFeeCNY, fixedFeeCNY: fFeeCNY, totalCostCNY: totalDeductionsCNY,
                    netProfitCNY: netProfit, margin, roi, breakEvenPriceRUB: breakEvenRUB, suggestedPriceRUB: activePriceRUB
                });
            };

            useEffect(() => {
                calculate();
                if (window.lucide) window.lucide.createIcons();
            }, [exchangeRate, sourcingCostCNY, domesticShippingCNY, weight, shippingRate, extraLogisticsCostCNY, platformFeePercent, paymentFeePercent, exchangeLossPercent, returnRatePercent, adCosPercent, fixedFeeRUB, targetMarginPercent, sellingPriceRUB, mode]);

            // 子组件
            const InputGroup = ({ label, value, onChange, step = "0.01", subtext, highlight, symbol, pos = "left" }) => (
                <div className="flex flex-col">
                    <label className={`text-[11px] font-bold mb-1.5 uppercase ${highlight ? 'text-fuchsia-700' : 'text-slate-500'}`}>{label}</label>
                    <div className="relative">
                        {pos === 'left' && symbol && <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs font-bold">{symbol}</span>}
                        <input type="number" step={step} value={value} onChange={(e) => onChange(e.target.value)}
                            className={`w-full py-2 border rounded-lg font-bold outline-none transition-colors text-sm ${pos === 'left' && symbol ? 'pl-7 pr-3' : ''} ${pos === 'right' && symbol ? 'pl-3 pr-8' : 'px-3'} ${highlight ? 'bg-fuchsia-50 border-fuchsia-200 text-fuchsia-900 focus:ring-1 focus:ring-fuchsia-500' : 'bg-slate-50 border-slate-200 text-slate-700 focus:ring-1 focus:ring-blue-500'}`}
                        />
                        {pos === 'right' && symbol && <span className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs font-bold">{symbol}</span>}
                    </div>
                    {subtext && <span className="text-[10px] text-slate-400 mt-1 leading-tight">{subtext}</span>}
                </div>
            );

            const CostRow = ({ label, value, color, isAlert, small }) => (
                <div className={`flex items-center justify-between ${small ? 'text-[11px]' : ''}`}>
                    <div className="flex items-center gap-2 overflow-hidden">
                        <div className={`w-2 h-2 rounded-full shrink-0 ${color}`}></div>
                        <span className={`text-slate-600 truncate ${isAlert ? 'text-red-500 font-bold' : ''}`}>{label}</span>
                    </div>
                    <div className="font-mono font-bold text-slate-700 shrink-0 ml-2">¥ {value.toFixed(2)}</div>
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-12">
                    <div className="bg-fuchsia-800 text-white p-6 shadow-lg">
                        <div className="max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-3">
                                <Icon name="calculator" className="w-8 h-8" />
                                <div>
                                    <h1 className="text-2xl font-bold tracking-tight">俄罗斯定价器</h1>
                                    <div className="text-fuchsia-200 text-xs">Robin专供版</div>
                                </div>
                            </div>
                            <div className="flex items-center gap-4 bg-fuchsia-900/40 px-5 py-3 rounded-lg backdrop-blur-sm border border-fuchsia-600/30">
                                <div className="flex flex-col items-end">
                                    <span className="text-xs text-fuchsia-200 font-medium mb-1">汇率设置 (1 CNY = ? RUB)</span>
                                    <div className="flex items-center gap-2">
                                        <span className="text-sm font-bold">¥ 1 = </span>
                                        <input type="number" value={exchangeRate} onChange={(e) => setExchangeRate(e.target.value)} className="w-20 bg-white text-fuchsia-900 px-2 py-1 rounded font-bold text-center outline-none border-2 border-transparent focus:border-fuchsia-400" />
                                        <span className="text-sm font-bold">₽</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-5xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 mt-4">
                        <div className="lg:col-span-7 space-y-5">
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <h3 className="flex items-center gap-2 font-semibold text-slate-700 mb-3 text-sm uppercase tracking-wide">
                                    <Icon name="settings" className="w-4 h-4 text-fuchsia-600" /> 快速配置
                                </h3>
                                <div className="flex gap-3">
                                    <button onClick={() => applyPreset('wildberries')} className={`flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all ${platform === 'wildberries' ? 'bg-fuchsia-600 text-white shadow-md ring-2 ring-fuchsia-200' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}>Wildberries</button>
                                    <button onClick={() => applyPreset('ozon')} className={`flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all ${platform === 'ozon' ? 'bg-blue-600 text-white shadow-md' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}>Ozon</button>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                                <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                    <h3 className="flex items-center gap-2 font-semibold text-slate-700 mb-4 text-sm uppercase"><Icon name="package" className="w-5 h-5 text-orange-500" /> 产品成本 (¥)</h3>
                                    <div className="space-y-4">
                                        <InputGroup label="采购单价 (CNY)" value={sourcingCostCNY} onChange={setSourcingCostCNY} symbol="¥" />
                                        <InputGroup label="国内运费 (CNY)" value={domesticShippingCNY} onChange={setDomesticShippingCNY} symbol="¥" />
                                    </div>
                                </div>
                                <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                    <h3 className="flex items-center gap-2 font-semibold text-slate-700 mb-4 text-sm uppercase"><Icon name="truck" className="w-5 h-5 text-teal-500" /> 跨境物流 (¥)</h3>
                                    <div className="space-y-4">
                                        <div className="flex gap-4">
                                            <InputGroup label="包裹重量 (kg)" value={weight} onChange={setWeight} />
                                            <InputGroup label="运费单价 (¥/kg)" value={shippingRate} onChange={setShippingRate} symbol="¥" />
                                        </div>
                                        <InputGroup label="其他操作费 (¥)" value={extraLogisticsCostCNY} onChange={setExtraLogisticsCostCNY} symbol="¥" />
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 ring-1 ring-fuchsia-100">
                                <h3 className="flex items-center gap-2 font-semibold text-slate-700 mb-4 text-sm uppercase"><Icon name="pie-chart" className="w-5 h-5 text-fuchsia-600" /> 变动费率与风险配置</h3>
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-6">
                                    <InputGroup label="平台佣金 (%)" value={platformFeePercent} onChange={setPlatformFeePercent} symbol="%" pos="right" />
                                    <InputGroup label="广告占比 (%)" value={adCosPercent} onChange={setAdCosPercent} symbol="%" pos="right" />
                                    <InputGroup label="单笔固定费 (₽)" value={fixedFeeRUB} onChange={setFixedFeeRUB} symbol="₽" />
                                    <div className="md:col-span-3 border-t border-slate-100 my-1 pt-4 grid grid-cols-2 md:grid-cols-3 gap-4">
                                        <InputGroup label="提现手续费 (%)" value={paymentFeePercent} onChange={setPaymentFeePercent} symbol="%" pos="right" />
                                        <InputGroup label="汇损率 (%)" value={exchangeLossPercent} onChange={setExchangeLossPercent} symbol="%" pos="right" />
                                        <InputGroup label="退货率 (%)" value={returnRatePercent} onChange={setReturnRatePercent} symbol="%" pos="right" subtext="按售价比例计入损耗" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="lg:col-span-5 space-y-6">
                            <div className="bg-white p-6 rounded-xl shadow-lg border-t-4 border-fuchsia-700">
                                <div className="flex bg-slate-100 p-1 rounded-lg mb-6">
                                    <button onClick={() => setMode('byPrice')} className={`flex-1 py-2 text-sm font-medium rounded-md transition-all ${mode === 'byPrice' ? 'bg-white text-fuchsia-700 shadow-sm' : 'text-slate-500'}`}>按定价算利润</button>
                                    <button onClick={() => setMode('byMargin')} className={`flex-1 py-2 text-sm font-medium rounded-md transition-all ${mode === 'byMargin' ? 'bg-white text-fuchsia-700 shadow-sm' : 'text-slate-500'}`}>按利润推定价</button>
                                </div>
                                <div className="mb-6">
                                    {mode === 'byPrice' ? (
                                        <div>
                                            <label className="block text-sm font-medium text-slate-600 mb-1 font-bold">建议零售价 (RUB)</label>
                                            <div className="relative">
                                                <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold text-lg">₽</span>
                                                <input type="number" value={sellingPriceRUB} onChange={(e) => setSellingPriceRUB(e.target.value)} className="w-full pl-10 pr-4 py-4 text-3xl font-bold text-slate-800 bg-slate-50 border border-slate-300 rounded-xl outline-none" />
                                            </div>
                                        </div>
                                    ) : (
                                        <div>
                                            <label className="block text-sm font-medium text-slate-600 mb-1 font-bold">设定目标利润率 (%)</label>
                                            <div className="relative">
                                                <input type="number" value={targetMarginPercent} onChange={(e) => setTargetMarginPercent(e.target.value)} className="w-full px-4 py-4 text-3xl font-bold text-fuchsia-600 bg-fuchsia-50 border border-fuchsia-200 rounded-xl outline-none" />
                                                <span className="absolute right-6 top-1/2 -translate-y-1/2 text-fuchsia-400 font-bold text-xl">%</span>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <div className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                                    <div className="flex justify-between items-end mb-4">
                                        <div>
                                            <div className="text-xs font-bold text-slate-400 uppercase">单单净利润</div>
                                            <div className={`text-3xl font-extrabold mt-1 ${results.netProfitCNY >= 0 ? 'text-green-600' : 'text-red-500'}`}>¥ {results.netProfitCNY.toFixed(2)}</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-xs font-bold text-slate-400 uppercase">实际利润率</div>
                                            <div className={`text-xl font-bold ${results.margin >= 15 ? 'text-fuchsia-600' : 'text-orange-500'}`}>{results.margin.toFixed(1)}%</div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-1 gap-3 pt-4 border-t border-slate-200">
                                        {mode === 'byMargin' && (
                                            <div className="bg-amber-100 p-4 rounded-lg border border-amber-200">
                                                <div className="text-xs font-bold text-amber-700 mb-1 uppercase">建议售价 (₽)</div>
                                                <div className="flex justify-between items-end">
                                                    <span className="text-3xl font-black text-amber-900">₽ {results.suggestedPriceRUB.toFixed(0)}</span>
                                                    <span className="text-sm font-bold text-amber-700/80 mb-1">≈ ¥ {(results.suggestedPriceRUB / exchangeRate).toFixed(1)}</span>
                                                </div>
                                            </div>
                                        )}
                                        <div className="flex justify-between items-center px-2">
                                            <span className="text-xs text-slate-500 flex items-center gap-1"><Icon name="trending-up" className="w-3 h-3" /> 保本价 (零利润)</span>
                                            <div className="text-right font-bold text-slate-700">₽ {results.breakEvenPriceRUB.toFixed(0)} <span className="text-xs font-normal text-slate-400 ml-1">(¥ {(results.breakEvenPriceRUB / exchangeRate).toFixed(1)})</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 text-sm space-y-3">
                                <h3 className="font-semibold text-slate-700 mb-4 text-xs uppercase tracking-widest">每单资金流向 (CNY折算)</h3>
                                <CostRow label="采购与国内运费" value={results.totalProductCostCNY} color="bg-blue-600" />
                                <CostRow label="头程物流运费" value={results.logisticsCNY} color="bg-teal-500" />
                                <CostRow label="退货风险损耗" value={results.returnLossCNY} color="bg-red-400" isAlert />
                                <div className="border-t border-slate-100 my-2"></div>
                                <div className="grid grid-cols-2 gap-x-6 gap-y-3">
                                    <CostRow label="平台佣金" value={results.platformFeeCNY} color="bg-fuchsia-400" small />
                                    <CostRow label="广告投入" value={results.marketingCNY} color="bg-fuchsia-300" small />
                                    <CostRow label="提现手续费" value={results.paymentFeeCNY} color="bg-orange-300" small />
                                    <CostRow label="预留汇损" value={results.exchangeLossCNY} color="bg-orange-200" small />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>

